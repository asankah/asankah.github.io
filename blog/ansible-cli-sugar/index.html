<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Easier CLI for ad-hoc Ansible tasks and playbooks</title><link href=https://asankah.github.io/index.xml rel=alternate type=application/rss+xml title="Asanka Herath"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://asankah.github.io/css/fonts.css><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://asankah.github.io/><h1 id=nav-heading class="title is-4">Asanka Herath</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=twitter href=https://twitter.com/@asankah target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i></span></a><a class=level-item aria-label=github href=https://github.com/asankah target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i></span></a><a class=level-item aria-label=email href=mailto:asanka@gmail.com target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></i></span></a><a class=level-item aria-label=rss href=/index.xml target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/asankah target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922h-4.388022v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"><a class="subtitle is-6" href=/tags/commandline/>#CommandLine</a>
| <a class="subtitle is-6" href=/tags/hacks/>#Hacks</a></div><h2 class="subtitle is-6">June 1, 2020 | 00:00</h2><h1 class=title>Easier CLI for ad-hoc Ansible tasks and playbooks</h1><div class=content><p>This article is about using <a href=https://ansible.com>Ansible</a> on the command-line.</p><h2 id=problem>Problem:</h2><p>You …</p><ul><li><p>… want a convenient way to do ad-hoc tasks on a bunch of machines.</p></li><li><p>… already have a few playbooks and machine groups defined in your inventory.</p></li><li><p>… don’t want to invest too much into Ansible because you have other things to do and Ansible is just a tool to deal with one aspect of what you want to do.</p></li><li><p>… live on the command-line.</p></li><li><p>… think <code>ansible-playbook</code> and <code>ansible</code> commands have too many knobs and too few knobs at the same time.</p></li></ul><h2 id=a-possible-solution>A Possible Solution</h2><p>Taking a page from old school Posix tools, let’s make a script that encodes Ansible group names into the filename.</p><p>Then you can go from this:</p><div class=sourceCode id=cb1><pre class="sourceCode sh"><code class="sourceCode bash"><a class=sourceLine id=cb1-1 title=1>$ <span class=ex>ansible</span> atlanta -m copy -a <span class=st>&quot;src=/etc/hosts dest=/tmp/hosts&quot;</span></a>
<a class=sourceLine id=cb1-2 title=2>$ <span class=ex>ansible</span> webservers -m service -a <span class=st>&quot;name=httpd state=started&quot;</span></a></code></pre></div><p>To this:</p><div class=sourceCode id=cb2><pre class="sourceCode sh"><code class="sourceCode bash"><a class=sourceLine id=cb2-1 title=1>$ <span class=ex>atlanta</span> copy <span class=st>&quot;src=/etc/hosts dest=/tmp/hosts&quot;</span></a>
<a class=sourceLine id=cb2-2 title=2>$ <span class=ex>webservers</span> service <span class=st>&quot;name=https state=started&quot;</span></a></code></pre></div><p>Or from this:</p><div class=sourceCode id=cb3><pre class="sourceCode sh"><code class="sourceCode bash"><a class=sourceLine id=cb3-1 title=1>$ <span class=ex>ansible-playbook</span> -l atlanta go-to-the-moon</a>
<a class=sourceLine id=cb3-2 title=2>$ <span class=ex>ansible-playbook</span> -l webservers do-the-other-things</a></code></pre></div><p>To this:</p><div class=sourceCode id=cb4><pre class="sourceCode sh"><code class="sourceCode bash"><a class=sourceLine id=cb4-1 title=1>$ <span class=ex>atlanta</span> go-to-the-moon</a>
<a class=sourceLine id=cb4-2 title=2>$ <span class=ex>webservers</span> do-the-other-things</a></code></pre></div><h2 id=setting-up>Setting Up</h2><p>These are just examples. Please don’t spend time bikeshedding names because you can use whichever names you like.</p><ol type=1><li><p>Download the contents of <code>ansible-by-proxy</code> from <a href=https://github.com/asankah/ansible-cli-sugar/blob/master/ansible-by-proxy>here</a>. It’s a starter script that includes a bunch of sensible settings expressed via environment variables. Remove or change these to match your needs.</p><p>Note that the script expects to find a sub-directory called <code>ansible</code> in the same directory as the script which contains the playbooks and the inventory file.</p></li><li><p>Store this file somewhere on the system <code>PATH</code>.</p><p>Don’t forget to mark the file as executable if it isn’t already.</p><div class=sourceCode id=cb5><pre class="sourceCode sh"><code class="sourceCode bash"><a class=sourceLine id=cb5-1 title=1>$ <span class=fu>chmod</span> +x ansible-by-proxy</a></code></pre></div></li><li><p>Create symlinks to the file that have the same name as hostnames or groups as described in the includes:</p><div class=sourceCode id=cb6><pre class="sourceCode sh"><code class="sourceCode bash"><a class=sourceLine id=cb6-1 title=1>$ <span class=fu>ln</span> -s ansible-by-proxy atlanta</a>
<a class=sourceLine id=cb6-2 title=2>$ <span class=fu>ln</span> -s ansible-by-proxy webservers</a></code></pre></div><p>and so on.</p></li></ol><p>That’s it. Now you can invoke playbooks and tasks just by using the name of host or group.</p></div></div></section><footer><div class="container has-text-centered"><p></p></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-169355711-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></footer></body></html>