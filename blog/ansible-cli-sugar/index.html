<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Easier CLI for ad-hoc Ansible tasks and playbooks &#183; Strong Opinions, Weekly Held</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/scss/fonts.min.css><link rel=stylesheet href=/css/formatting.min.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href rel=alternate type=application/rss+xml title="Strong Opinions, Weekly Held"><link rel=stylesheet href=https://xn--izc.com/_katex/katex.min.3493557c40ba8df12deb6c1031a7cb353d9e23a05a58e3576e991211502cdfef.css integrity="sha256-NJNVfEC6jfEt62wQMafLNT2eI6BaWONXbpkSEVAs3+8="><script src=https://xn--izc.com/_katex/katex.min.093945cfb872f8fdf36e3730db70625111c0cb4e643520f70eabd1703ede483f.js integrity="sha256-CTlFz7hy+P3zbjcw23BiURHAy05kNSD3DqvRcD7eSD8="></script><script src=https://xn--izc.com/js/render-katex.min.js async></script></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>Strong Opinions, Weekly Held</h2></a><ul><li><a href=/about/me><span>About Me</span></a></li><li><a href=/tags><span>Tags</span></a></li></ul></div></nav><main><div class=post><h1 class=post-title>Easier CLI for ad-hoc Ansible tasks and playbooks</h1><div class=post-info><span>Written by</span>
Asanka Herath
<span>on&nbsp;</span><time datetime="2020-06-01 00:00:00 +0000 UTC">June 1, 2020</time>
|
<a href=/tags/tools>#Tools</a></div><div class="social share"><a href="https://twitter.com/intent/tweet?text=Easier+CLI+for+ad-hoc+Ansible+tasks+and+playbooks&amp;url=https%3A%2F%2Fxn--izc.com%2Fblog%2Fansible-cli-sugar%2F&amp;via=asankah" aria-label="Share on Twitter" target=_blank rel=noopener><img src=/images/twitter.svg alt="Share on Twitter"></a>
<a href="mailto:?body=Via+https%3A%2F%2Ftwitter.com%2Fasankah%0A%0AEncode+the+host+and+group+names+into+the+name+of+a+wrapper+script+for%0Aquick+ad-hoc+invocation+of+Ansible+tasks+and+playbooks.%0A%0ARead+more+at+https%3A%2F%2Fxn--izc.com%2Fblog%2Fansible-cli-sugar%2F%0A&amp;subject=Easier+CLI+for+ad-hoc+Ansible+tasks+and+playbooks+-+Strong+Opinions%2C+Weekly+Held" aria-label="Share via Email" target=_blank rel=noopener><img src=/images/mail.svg alt="Share via Email"></a>
<a href=https://xn--izc.com/blog/ansible-cli-sugar/ aria-label="Permanent link to post"><img src=/images/link-2.svg alt="Permanent link to post"></a></div><p>This article is about using <a href=https://ansible.com>Ansible</a>
on the command-line.</p><h2 id=problem>Problem:</h2><p>You …</p><ul><li><p>… want a convenient way to do ad-hoc tasks on a bunch of
machines.</p></li><li><p>… already have a few playbooks and machine groups defined in your
inventory.</p></li><li><p>… don’t want to invest too much into Ansible because you have
other things to do and Ansible is just a tool to deal with one aspect of
what you want to do.</p></li><li><p>… live on the command-line.</p></li><li><p>… think <code>ansible-playbook</code> and <code>ansible</code>
commands have too many knobs and too few knobs at the same
time.</p></li></ul><h2 id=a-possible-solution>A Possible Solution</h2><p>Taking a page from old school Posix tools, let’s make a script that
encodes Ansible group names into the filename.</p><p>Then you can go from this:</p><div class=sourceCode id=cb1><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> ansible atlanta <span class=at>-m</span> copy <span class=at>-a</span> <span class=st>&quot;src=/etc/hosts dest=/tmp/hosts&quot;</span></span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true tabindex=-1></a><span class=ex>$</span> ansible webservers <span class=at>-m</span> service <span class=at>-a</span> <span class=st>&quot;name=httpd state=started&quot;</span></span></code></pre></div><p>To this:</p><div class=sourceCode id=cb2><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb2-1><a href=#cb2-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> atlanta copy <span class=st>&quot;src=/etc/hosts dest=/tmp/hosts&quot;</span></span>
<span id=cb2-2><a href=#cb2-2 aria-hidden=true tabindex=-1></a><span class=ex>$</span> webservers service <span class=st>&quot;name=https state=started&quot;</span></span></code></pre></div><p>Or from this:</p><div class=sourceCode id=cb3><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb3-1><a href=#cb3-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> ansible-playbook <span class=at>-l</span> atlanta go-to-the-moon</span>
<span id=cb3-2><a href=#cb3-2 aria-hidden=true tabindex=-1></a><span class=ex>$</span> ansible-playbook <span class=at>-l</span> webservers do-the-other-things</span></code></pre></div><p>To this:</p><div class=sourceCode id=cb4><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb4-1><a href=#cb4-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> atlanta go-to-the-moon</span>
<span id=cb4-2><a href=#cb4-2 aria-hidden=true tabindex=-1></a><span class=ex>$</span> webservers do-the-other-things</span></code></pre></div><h2 id=setting-up>Setting Up</h2><p>These are just examples. Please don’t spend time bikeshedding names
because you can use whichever names you like.</p><ol type=1><li><p>Download the contents of <code>ansible-by-proxy</code> from <a href=https://github.com/asankah/ansible-cli-sugar/blob/master/ansible-by-proxy>here</a>.
It’s a starter script that includes a bunch of sensible settings
expressed via environment variables. Remove or change these to match
your needs.</p><p>Note that the script expects to find a sub-directory called
<code>ansible</code> in the same directory as the script which contains
the playbooks and the inventory file.</p></li><li><p>Store this file somewhere on the system <code>PATH</code>.</p><p>Don’t forget to mark the file as executable if it isn’t already.</p><div class=sourceCode id=cb5><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb5-1><a href=#cb5-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> chmod +x ansible-by-proxy</span></code></pre></div></li><li><p>Create symlinks to the file that have the same name as hostnames
or groups as described in the includes:</p><div class=sourceCode id=cb6><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb6-1><a href=#cb6-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> ln <span class=at>-s</span> ansible-by-proxy atlanta</span>
<span id=cb6-2><a href=#cb6-2 aria-hidden=true tabindex=-1></a><span class=ex>$</span> ln <span class=at>-s</span> ansible-by-proxy webservers</span></code></pre></div><p>and so on.</p></li></ol><p>That’s it. Now you can invoke playbooks and tasks just by using the
name of host or group.</p><nav class=suggested><h2 class=suggested>More articles from this blog</h4><ul><li><h3 class="suggested title"><a href=/blog/the-lettergrade-rule/>The Lettergrade Rule</a></h3><p>Don’t block a code review because of minor issues that are best left
to the discretion of the author.</p></li><li><h3 class="suggested title"><a href=/blog/identity-domains/>Identity Domains</a></h3><p>An Identity Domain is a scope within which we assume that the user’s
identity can roam freely.</p></li><li><h3 class="suggested title"><a href=/blog/visualizing-people/>Visualizing Internet Users</a></h3><p>What does 0.3%1 of internet users look like?
As of this writing the global population hovers around 7.7 billion according to the World Population Clock 2.
Screenshot from census.gov showing the world population clock. The International Telecommunications Union “estimates that at the end of 2019, 53.6 per cent of the global population, or 4.1 billion people, are using the internet.”3
Screenshot from itu.int showing historical internet usage numbers as a percentage of the world population So a 0.</p></li><li><h3 class="suggested title"><a href=/blog/how-this-blog-works/>How This Blog Works</a></h3><p>How I put this site together and why.</p></li><li><h3 class="suggested title"><a href=/blog/shannon-paper/>Shannon Paper</a></h3><p>Claude Shannon’s <em>A mathematical theory of communication</em> is
an oft cited classic in information theory. Let’s dive in and try to
tease apart the “why”s that are often overlooked when people build on
top of the introduced theory. They are definitely things that I didn’t
consider to be obvious without the benefit of reading the paper.</p></li></ul></nav><h4>Comment</h4><script src=https://utteranc.es/client.js repo=asankah/blog-comments issue-term=title label=PublicComment theme=github-light crossorigin=anonymous async></script></div><div class=pagination><a href=/blog/identity-domains/ class="left arrow">&#8592;</a>
<a href=/blog/notes-on-fact-checking/ class="right arrow">&#8594;</a>
<a href=# class=top>Top</a></div></main><footer><span>Last modified on January 13, 2022</span></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-GSREL2EZ4Y"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GSREL2EZ4Y",{anonymize_ip:!1})}</script></body></html>