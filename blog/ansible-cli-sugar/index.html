<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Easier CLI for ad-hoc Ansible tasks and playbooks</title><link rel=stylesheet href=/css/style.css></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://asankah.github.io/><h1 id=nav-heading class="title is-4">Asanka Herath</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"></nav></div></nav><nav class=nav></nav></div></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"></div><h2 class="subtitle is-6">June 1, 2020 | 00:00</h2><h1 class=title>Easier CLI for ad-hoc Ansible tasks and playbooks</h1><div class=content><p>This article is about using <a href=https://ansible.com>Ansible</a> on the command-line.</p><h2 id=problem>Problem:</h2><p>You &mldr;</p><ul><li><p>&mldr; want a convenient way to do ad-hoc tasks on a bunch of machines.</p></li><li><p>&mldr; already have a few playbooks and machine groups defined in your inventory.</p></li><li><p>&mldr; don&rsquo;t want to invest too much into Ansible because you have other things
to do and Ansible is just a tool to deal with one aspect of what you want to
do.</p></li><li><p>&mldr; live on the command-line.</p></li><li><p>&mldr; think <code>ansible-playbook</code> and <code>ansible</code> commands have too many knobs and
too few knobs at the same time.</p></li></ul><h2 id=a-possible-solution>A Possible Solution</h2><p>Taking a page from old school Posix tools, let&rsquo;s make a script that encodes
Ansible group names into the filename.</p><p>Then you can go from this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ ansible atlanta -m copy -a <span style=color:#e6db74>&#34;src=/etc/hosts dest=/tmp/hosts&#34;</span>
$ ansible webservers -m service -a <span style=color:#e6db74>&#34;name=httpd state=started&#34;</span>
</code></pre></div><p>To this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ atlanta copy <span style=color:#e6db74>&#34;src=/etc/hosts dest=/tmp/hosts&#34;</span>
$ webservers service <span style=color:#e6db74>&#34;name=https state=started&#34;</span>
</code></pre></div><p>Or from this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ ansible-playbook -l atlanta go-to-the-moon
$ ansible-playbook -l webservers <span style=color:#66d9ef>do</span>-the-other-things
</code></pre></div><p>To this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ atlanta go-to-the-moon
$ webservers <span style=color:#66d9ef>do</span>-the-other-things
</code></pre></div><h2 id=setting-up>Setting Up</h2><p>These are just examples. Please don&rsquo;t spend time bikeshedding names because you
can use whichever names you like.</p><ol><li><p>Download the contents of <code>ansible-by-proxy</code> from
<a href=https://github.com/asankah/ansible-cli-sugar/blob/master/ansible-by-proxy>here</a>.
It&rsquo;s a starter script that includes a bunch of sensible settings expressed
via environment variables. Remove or change these to match your needs.</p><p>Note that the script expects to find a sub-directory called <code>ansible</code> in the
same directory as the script which contains the playbooks and the inventory
file.</p></li><li><p>Store this file somewhere on the system <code>PATH</code>.</p><p>Don&rsquo;t forget to mark the file as executable if it isn&rsquo;t already.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ chmod +x ansible-by-proxy
</code></pre></div></li><li><p>Create symlinks to the file that have the same name as hostnames or groups as
described in the includes:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ ln -s ansible-by-proxy atlanta
$ ln -s ansible-by-proxy webservers
</code></pre></div><p>and so on.</p></li></ol><p>That&rsquo;s it. Now you can invoke playbooks and tasks just by using the name of host
or group.</p></div></div></section><footer><div class="container has-text-centered"><p></p></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-169355711-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></footer></body></html>