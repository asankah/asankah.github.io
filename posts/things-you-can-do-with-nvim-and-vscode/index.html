<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8" />
    <title>
      Things You Can Do With Neovim and Vscode That You Can&#39;t Do With Neovim
      Alone
    </title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/images/apple-touch-icon.png"
    />
    <link rel="icon" href="/images/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/images/favicon-32x32.png"
    />
    <link rel="manifest" href="/site.webmanifest" />
    <link
      rel="mask-icon"
      href="/images/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Geist:wght@100..900&family=Inconsolata:wght@200..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles/katex.min.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
    />
    <link rel="stylesheet" href="/styles/aro4OGNh0r.css" />
    <link rel="me" href="mailto:asanka@gmail.com" />
    <link rel="me" href="https://github.com/asankah" />

    <meta name="generator" content="Pandoc + Eleventy" />
  </head>

  <body>
    <header class="container">
      <nav class="top" itemscope="" itemtype="https://schema.org/Blog">
        <h1 itemprop="name">
          <a href="/" itemprop="url">Strong Opinions Weekly Held</a>
        </h1>
        <span></span>

        <h2><a href="/">Home</a></h2>

        <h2 itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="/about/me/" itemprop="sameAs">About</a>
        </h2>
        <h2><a href="/tags/">Tags</a></h2>
        <h2>
          <a href="/feed.xml"><img src="/images/rss.svg" /></a>
        </h2>
      </nav>
    </header>

    <article itemscope="" itemtype="https://schema.org/BlogPosting">
      <link
        itemprop="url"
        href="/posts/things-you-can-do-with-nvim-and-vscode/"
      />
      <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
      <header class="container">
        <div class="">
          <h1 itemprop="name">
            Things You Can Do With Neovim and Vscode That You Can&#39;t Do With
            Neovim Alone
          </h1>
          <nav>
            <div class="metadata">
              Published on
              <time datetime="2020-09-19" itemprop="datePublished"
                >September 19, 2020</time
              >
              by <span class="author" itemprop="author">Asanka Herath</span>.

              <br />
              Estimated reading time is <time>11 minutes</time>.
            </div>
            <span></span>
            <menu class="tags">
              <li>
                <span class="tag">
                  <a href="/tags/tools/">#Tools</a>
                </span>
              </li>
              <li>
                <span class="tag">
                  <a href="/tags/vim/">#Vim</a>
                </span>
              </li>
            </menu>
          </nav>
        </div>
      </header>

      <main itemprop="articleBody" class="container">
        <p>
          This is the third time I’ve tried in earnest to switch to VSCode from
          Vim (or Neovim in my case) for reasons not all of which are relevant
          to this post. But I love Vim style modal editing and I’ve grown
          accustomed to some features that aren’t present or not well emulated
          in <a href="https://github.com/VSCodeVim/Vim">VSCodeVim</a>.
        </p>
        <p>
          Enter
          <a href="https://github.com/asvetliakov/vscode-neovim"
            >VSCode Neovim</a
          >. I was intrigued by their claim to integrate Neovim instead of
          trying to emulate Vim. After going through the code a bit I thought
          this extension alone warranted a new attempt at switching to VSCode.
          So far it’s going great.
        </p>
        <h2 id="how-vscode-neovim-works">How VSCode Neovim Works</h2>
        <p>
          Here’s the gist of how this extension works. Feel free to skip to the
          good stuff below but this section is good background information for
          understanding <em>why</em> it works the way it does.
        </p>
        <ol type="1">
          <li>
            <p><strong>Invokes an embedded Neovim instance.</strong></p>
            <p>
              Code for this is in the <code>main_controller.ts</code> (<a
                href="https://github.com/asvetliakov/vscode-neovim/blob/master/src/main_controller.ts"
                >linky</a
              >) if you are curious about how exactly it’s implemented and the
              commandline options that are passed in.
            </p>
            <p>
              You’ll also notice that the code invokes
              <code>--cmd source ${neovimSupportScriptPath}</code> which runs
              <code>vim/vscode-neovim.vim</code> (<a
                href="https://github.com/asvetliakov/vscode-neovim/blob/master/vim/vscode-neovim.vim"
                >linky</a
              >) before running your <code>init.vim</code> file. This script is
              what sets up the <code>g:vscode</code> flag and sources all the
              other <code>vscode-*.vim</code> scripts except
              <code>vscode-options.vim</code>. The latter runs
              <em>after</em> your <code>init.vim</code> in order to force some
              settings that would otherwise break the extension or cause Neovim
              to be confused.
            </p>
          </li>
        </ol>
        <p>
          So far this is pretty standard fare for how Neovim would be embedded
          for a custom UI. But things get a bit interesting from the next step.
        </p>
        <ol start="2" type="1">
          <li>
            <p>
              <strong
                >Creates a new Neovim buffer and window corresponding to a
                VSCode editor.</strong
              >
            </p>
            <p>
              The buffer thus created is a plain text buffer without any bells
              or whistles. Contents of the buffer comes from VSCode<a
                href="#fn1"
                class="footnote-ref"
                id="fnref1"
                role="doc-noteref"
                ><sup>1</sup></a
              >. VSCodeNeovim synchronizes the content between the Neovim buffer
              and the VSCode editor. Thus the relationship between the contents
              and the corresponding file on disk is mediated through VSCode.
              This is a key difference between other custom UIs and this one and
              one that opens many possibilities.
            </p>
            <p>
              VSCodeNeovim defers to VSCode for handling insert mode. VSCode
              handles autocompletion and other assistive features. You’ll have
              to get used to your insert mode customizations not working, or
              replicating that with VSCode keyboard mapping customizations. When
              exiting insert mode the extension asynchronously synchronizes the
              buffer contents – which at this point would include the changes
              that were introduced – with Neovim. The code for synchronizing the
              VSCode editor contents and the Neovim buffer is in
              <code>buffer_manager.ts</code> (<a
                href="https://github.com/asvetliakov/vscode-neovim/blob/master/src/buffer_manager.ts"
                >linky</a
              >) which is also a good place to look if you want to know the
              details about buffer options that are being set.
            </p>
          </li>
        </ol>
        <p>
          Of course I’m eliding lots of detail here including integrations for
          other areas of UI. But I think this captures the pertinent details.
          The extension is a pretty impressive piece of work which is well worth
          a gander. Now on to the good stuff.
        </p>
        <h2 id="responsive-neovim-experience-over-a-laggy-ssh-connection">
          Responsive Neovim Experience Over A laggy SSH Connection
        </h2>
        <p>
          This gets to the reason why I’m trying to move to VSCode in the first
          place. I work on a project consisting of thousands of C++ source
          files. My home-office doesn’t have enough hardware to do regular
          builds, or in fact any build at all. The beefy machines are in a
          remote location accessible via SSH.
        </p>
        <p>
          I’ve been using Neovim over SSH for a while, but the latency really
          bothers me. And no, neither SCP nor SSHFS scratches this itch because
          I won’t have access to language smarts like <code>clangd</code> which
          require access to all the source files and some build tooling.
        </p>
        <p>
          <a href="https://code.visualstudio.com/docs/remote/remote-overview"
            >VSCode Remote Development</a
          >
          was a nearly perfect answer with the exception that VSCodeVim didn’t
          quite have all the functionality I needed. VSCodeNeovim addresses that
          last piece of the puzzle.
        </p>
        <p>VSCode + Remote SSH + VSCodeNeovim + Neovim gives me:</p>
        <figure>
          <img
            src="/posts/things-you-can-do-with-nvim-and-vscode/4qsgTpY4ng-1266.png"
            alt="Architecture of VSCode + Remote SSH + VSCodeNeovim + Neovim"
            width="1266"
            height="352"
          />
          <figcaption aria-hidden="true">
            Architecture of VSCode + Remote SSH + VSCodeNeovim + Neovim
          </figcaption>
        </figure>
        <ul>
          <li>
            On the remote machine:
            <ul>
              <li>Source files.</li>
              <li>Build tooling.</li>
              <li>
                <code>clangd</code> process invoked via
                <code>vscode-remote</code>.
              </li>
            </ul>
          </li>
          <li>
            On the local machine:
            <ul>
              <li>VSCode.</li>
              <li>
                VSCodeNeovim.
                <ul>
                  <li>
                    Neovim instance embedded by VSCodeNeovim.
                    <ul>
                      <li>Neovim plug-ins and normal mode keybindings.</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
        <p>
          Since the embedded Neovim instance is local the editors are super
          responsive. Completions via <code>clangd</code> is still laggy as one
          might expect. But that’s something I’m willing to live with.
        </p>
        <h2 id="proportional-fonts-with-neovim">
          Proportional Fonts With Neovim
        </h2>
        <p>
          Okay, so why would anyone actually want this? Turns out
          <a
            href="https://www.google.com/search?q=proportional+fonts+for+coding"
            >I’m not the only one</a
          >. In my case I prefer monospace for regular code, but I’d much much
          rather read comments and prose in proportional font. Also, I now spend
          a lot of my time writing Markdown with LatexMath. Staring at
          monospaced prose all day is not my cup of tea.
        </p>
        <p>
          This is what it looks like when I’m editing this post in VSCode (in
          Markdown).
        </p>
        <figure>
          <img
            src="/posts/things-you-can-do-with-nvim-and-vscode/nwNiA_mUF4-741.png"
            alt="Screenshot of VSCode editing Markdown in proportional font"
            width="741"
            height="221"
          />
          <figcaption aria-hidden="true">
            Screenshot of VSCode editing Markdown in proportional font
          </figcaption>
        </figure>
        <p>
          The best part is that I can use my familiar Vim/Neovim keybindings and
          modal editing. I had to make a couple of customizations and I only
          have this set up for Markdown. But it works fairly well. One gotcha is
          that the cursor jumps horizontally when moving the cursor up or down
          since the columns are no longer neatly aligned.
        </p>
        <h3 id="monospace-code-with-proportional-comments">
          Monospace Code With Proportional Comments?
        </h3>
        <p>
          What I really want isn’t proportional fonts everywhere. Rather I only
          want proportional fonts for prose. In code, this would take the form
          of comments.
        </p>
        <p>
          Unfortunately, VSCode doesn’t support changing the font for specific
          syntactic tokens or scopes. That would’ve been ideal because it would
          let me configure things so that comments are in proportional font
          while the rest is in monospace. Also in the case of Markdown, I’d be
          able to make everything proportional except for inline code and fenced
          code blocks. Alas we are not quite there yet. Several feature requests
          already exist<a
            href="#fn2"
            class="footnote-ref"
            id="fnref2"
            role="doc-noteref"
            ><sup>2</sup></a
          >, but hasn’t seen much activity.
        </p>
        <h2 id="takeaways">Takeaways</h2>
        <ol type="1">
          <li>
            VSCodeNeovim is a functional replacement for the avid Neovim or
            perhaps Vim user who wants it both ways. Lots of caveats exist
            including the fact that Neovim mode only really works inside editor
            windows.
          </li>
          <li>
            VSCodeNeovim + “Remote SSH” is an awesome combination for editing
            remote files using Neovim with the latency of a local Neovim
            instance.
          </li>
          <li>
            You can use proportional fonts with VSCodeNeovim for super double
            awesomeness.
          </li>
        </ol>
        <section
          id="footnotes"
          class="footnotes footnotes-end-of-document"
          role="doc-endnotes"
        >
          <hr />
          <ol>
            <li id="fn1">
              <p>
                Not quite the whole story because it’s possible a buffer be
                created inside the Neovim instance and have it be mirrored in a
                VSCode editor. But that’s probably not what you’ll be using on a
                regular basis.<a
                  href="#fnref1"
                  class="footnote-back"
                  role="doc-backlink"
                  >↩︎</a
                >
              </p>
            </li>
            <li id="fn2">
              <p>
                A quick search in the VSCode repository
                <a
                  href="https://github.com/microsoft/vscode/search?q=tokenColorCustomizations+font+name"
                  >with this query</a
                >
                yields several issues that request for pretty much the same
                thing: Allow setting <code>fontName</code> in
                <code>tokenColorCustomizations</code>. There’s also
                <a href="https://github.com/deepanrajkumar/Italic-and-Ligature"
                  >this curious experiment</a
                >
                which patches in a different font for italics so that you can
                use the existing <code>fontStyle: "italic"</code> option in
                <code>tokenColorCustomizations</code> to switch fonts.<a
                  href="#fnref2"
                  class="footnote-back"
                  role="doc-backlink"
                  >↩︎</a
                >
              </p>
            </li>
          </ol>
        </section>
      </main>

      <footer class="container">
        <div>
          <p>
            Last modified: <time datetime="2020-09-19">September 19, 2020</time>
          </p>
        </div>
      </footer>
    </article>

    <div class="container"></div>

    <footer class="container">
      <h2>More posts from this blog ...</h2>
      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/posts/ten-years/">
            <span itemprop="name">Ten Years</span>
          </a>
        </h3>
        <div class="summary-row">
          <div>
            <nav>
              <small>
                Published on
                <time datetime="2020-12-09" itemprop="datePublished"
                  >December 9, 2020</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag">
                    <a href="/tags/career/">#Career</a>
                  </span>
                </li>
              </menu>
            </nav>
            <p class="more"><a href="/posts/ten-years/">Read more …</a></p>
          </div>
        </div>
      </div>

      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a
            itemprop="url"
            href="/posts/gender-gap-in-adolescent-mental-health/"
          >
            <span itemprop="name"
              >On Gender Gap in Adolescent Mental Health</span
            >
          </a>
        </h3>
        <div class="summary-row">
          <div>
            <nav>
              <small>
                Published on
                <time datetime="2022-03-01" itemprop="datePublished"
                  >March 1, 2022</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag">
                    <a href="/tags/inclusion-and-equity/"
                      >#Inclusion and Equity</a
                    >
                  </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  A recent study found that more gender-equal countries have
                  larger gender gaps in mental health. I look at the data that
                  seems to have yielded this counter-intuitive results and find
                  it lacking.
                </p>
              </div>
            </div>
            <p class="more">
              <a href="/posts/gender-gap-in-adolescent-mental-health/"
                >Read more …</a
              >
            </p>
          </div>
        </div>
      </div>

      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/posts/use-drop-not-edit/">
            <span itemprop="name"
              >Vim: Use Drop Not Edit, SBuffer Not Buffer</span
            >
          </a>
        </h3>
        <div class="summary-row">
          <div>
            <nav>
              <small>
                Published on
                <time datetime="2020-07-07" itemprop="datePublished"
                  >July 7, 2020</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag">
                    <a href="/tags/tools/">#Tools</a>
                  </span>
                </li>
                <li>
                  <span class="tag">
                    <a href="/tags/vim/">#Vim</a>
                  </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  Use the <code>:drop</code> command instead of
                  <code>:edit</code> in Vim. It will reuse an existing window
                  instead of creating a new one.
                </p>
              </div>
            </div>
            <p class="more">
              <a href="/posts/use-drop-not-edit/">Read more …</a>
            </p>
          </div>
        </div>
      </div>

      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/series/structure-of-experience/flame/"
            ><span class="series-name">Structure Of Experience</span>:
            <span itemprop="name">Act III: Flame</span>
          </a>
        </h3>
        <div class="summary-row">
          <div>
            <nav>
              <small>
                Published on
                <time datetime="2025-05-07" itemprop="datePublished"
                  >May 7, 2025</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag">
                    <a href="/tags/ai/">#AI</a>
                  </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  The map is not the territory. A picture of a flame is not a
                  flame. A description of a neural network is not a brain. A
                  simulation of thought is not a consciousness.
                </p>
              </div>
            </div>
            <p class="more">
              <a href="/series/structure-of-experience/flame/">Read more …</a>
            </p>
          </div>
        </div>
      </div>

      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/posts/optimal-line-length/">
            <span itemprop="name"
              >Optimal line-length for publishing on the web</span
            >
          </a>
        </h3>
        <div class="summary-row">
          <a href="/posts/optimal-line-length/">
            <img
              src="/img/uRhvj-9rJi-600.png"
              alt='A linotype slug for the text "Optimal Line Length"'
              class="noinvert hero"
              width="600"
              height="600"
            />
          </a>

          <div>
            <nav>
              <small>
                Published on
                <time datetime="2025-10-05" itemprop="datePublished"
                  >October 5, 2025</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag">
                    <a href="/tags/usability/">#Usability</a>
                  </span>
                </li>
                <li>
                  <span class="tag">
                    <a href="/tags/curiosity/">#Curiosity</a>
                  </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  Line-length and line-spacing slightly affect the ergonomics of
                  reading on the web, but not significantly. However, evidence
                  suggests that adults prefer &quot;medium&quot; length columns
                  of text.
                </p>
              </div>
            </div>
            <p class="more">
              <a href="/posts/optimal-line-length/">Read more …</a>
            </p>
          </div>
        </div>
      </div>
    </footer>

    <script
      async=""
      src="https://www.googletagmanager.com/gtag/js?id=G-GSREL2EZ4Y"
    ></script>
    <script>
      var dnt,
        doNotTrack = !1;
      if (
        (!1 &&
          ((dnt =
            navigator.doNotTrack ||
            window.doNotTrack ||
            navigator.msDoNotTrack),
          (doNotTrack = dnt == "1" || dnt == "yes")),
        !doNotTrack)
      ) {
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        (gtag("js", new Date()), gtag("config", "G-GSREL2EZ4Y"));
      }
    </script>
  </body>
</html>
