<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8" />
    <title>Easier CLI for ad-hoc Ansible tasks and playbooks</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/images/apple-touch-icon.png"
    />
    <link rel="icon" href="/images/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/images/favicon-32x32.png"
    />
    <link rel="manifest" href="/site.webmanifest" />
    <link
      rel="mask-icon"
      href="/images/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <link rel="stylesheet" href="/styles/katex.min.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
    />
    <link rel="stylesheet" href="/styles/Bzyqb5Ytgc.css" />
    <link rel="me" href="mailto:asanka@gmail.com" />
    <link rel="me" href="https://github.com/asankah" />

    <meta name="generator" content="Pandoc + Eleventy" />
  </head>

  <body>
    <header class="container">
      <nav class="top" itemscope="" itemtype="https://schema.org/Blog">
        <h1 itemprop="name">
          <a href="/" itemprop="url">Strong Opinions Weekly Held</a>
        </h1>
        <span class="fill"></span>

        <h2><a href="/">Home</a></h2>

        <h2 itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="/about/me/" itemprop="sameAs">About</a>
        </h2>
        <h2><a href="/tags/">Tags</a></h2>
        <h2>
          <a href="/feed.xml"><img src="/images/rss.svg" /></a>
        </h2>
      </nav>
    </header>

    <article
      class="container"
      itemscope=""
      itemtype="https://schema.org/BlogPosting"
    >
      <link itemprop="url" href="/posts/ansible-cli-sugar/" />
      <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
      <header>
        <h1 itemprop="name">
          Easier CLI for ad-hoc Ansible tasks and playbooks
        </h1>
        <nav>
          <span>
            <span class="date"
              >Posted on
              <time datetime="2020-06-01" itemprop="datePublished"
                >June 1, 2020</time
              ></span
            >&nbsp;by
            <span class="author" itemprop="author">Asanka Herath</span></span
          >
          <span class="fill"></span>

          <span class="tag-link">
            <a href="/tags/tools/">#Tools</a>
          </span>
        </nav>
        <div>
          <span class="readingtime">
            Estimated reading time is 4 minutes.
          </span>
        </div>
      </header>

      <main itemprop="articleBody">
        <p>
          This article is about using
          <a href="https://ansible.com">Ansible</a> on the command-line.
        </p>
        <h2>Problem:</h2>
        <p>You …</p>
        <ul>
          <li>
            <p>
              … want a convenient way to do ad-hoc tasks on a bunch of machines.
            </p>
          </li>
          <li>
            <p>
              … already have a few playbooks and machine groups defined in your
              inventory.
            </p>
          </li>
          <li>
            <p>
              … don’t want to invest too much into Ansible because you have
              other things to do and Ansible is just a tool to deal with one
              aspect of what you want to do.
            </p>
          </li>
          <li>
            <p>… live on the command-line.</p>
          </li>
          <li>
            <p>
              … think <code>ansible-playbook</code> and
              <code>ansible</code> commands have too many knobs and too few
              knobs at the same time.
            </p>
          </li>
        </ul>
        <h2>A Possible Solution</h2>
        <p>
          Taking a page from old school Posix tools, let’s make a script that
          encodes Ansible group names into the filename.
        </p>
        <p>Then you can go from this:</p>
        <pre><code class="language-sh">$ ansible atlanta -m copy -a &quot;src=/etc/hosts dest=/tmp/hosts&quot;
$ ansible webservers -m service -a &quot;name=httpd state=started&quot;
</code></pre>
        <p>To this:</p>
        <pre><code class="language-sh">$ atlanta copy &quot;src=/etc/hosts dest=/tmp/hosts&quot;
$ webservers service &quot;name=https state=started&quot;
</code></pre>
        <p>Or from this:</p>
        <pre><code class="language-sh">$ ansible-playbook -l atlanta go-to-the-moon
$ ansible-playbook -l webservers do-the-other-things
</code></pre>
        <p>To this:</p>
        <pre><code class="language-sh">$ atlanta go-to-the-moon
$ webservers do-the-other-things
</code></pre>
        <h2>Setting Up</h2>
        <p>
          These are just examples. Please don’t spend time bikeshedding names
          because you can use whichever names you like.
        </p>
        <ol>
          <li>
            <p>
              Download the contents of <code>ansible-by-proxy</code> from
              <a
                href="https://github.com/asankah/ansible-cli-sugar/blob/master/ansible-by-proxy"
                >here</a
              >. It’s a starter script that includes a bunch of sensible
              settings expressed via environment variables. Remove or change
              these to match your needs.
            </p>
            <p>
              Note that the script expects to find a sub-directory called
              <code>ansible</code> in the same directory as the script which
              contains the playbooks and the inventory file.
            </p>
          </li>
          <li>
            <p>Store this file somewhere on the system <code>PATH</code>.</p>
            <p>
              Don’t forget to mark the file as executable if it isn’t already.
            </p>
            <pre><code class="language-sh">$ chmod +x ansible-by-proxy
</code></pre>
          </li>
          <li>
            <p>
              Create symlinks to the file that have the same name as hostnames
              or groups as described in the includes:
            </p>
            <pre><code class="language-sh">$ ln -s ansible-by-proxy atlanta
$ ln -s ansible-by-proxy webservers
</code></pre>
            <p>and so on.</p>
          </li>
        </ol>
        <p>
          That’s it. Now you can invoke playbooks and tasks just by using the
          name of host or group.
        </p>
      </main>

      <footer>
        <div class="lastmodified">
          <p>Last modified: <time datetime="2020-06-01">June 1, 2020</time></p>
        </div>
      </footer>
    </article>

    <div class="container"></div>

    <footer class="container">
      <h2>More posts from this blog ...</h2>
      <div
        class="post-card"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/posts/ten-years/">
            <span itemprop="name">Ten Years</span>
          </a>
        </h3>
        <nav>
          <span class="date">
            Last updated on
            <time datetime="2020-12-09" itemprop="datePublished"
              >December 9, 2020</time
            >
          </span>

          <span class="fill"></span>

          <span class="tag-link">
            <a href="/tags/career/">#Career</a>
          </span>
        </nav>
      </div>

      <div
        class="post-card"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/posts/on-wontfixing-bugs/">
            <span itemprop="name">On WontFixing Bugs</span>
          </a>
        </h3>
        <nav>
          <span class="date">
            Last updated on
            <time datetime="2021-03-02" itemprop="datePublished"
              >March 2, 2021</time
            >
          </span>

          <span class="fill"></span>

          <span class="tag-link">
            <a href="/tags/engineering/">#Engineering</a>
          </span>
        </nav>
        <div>
          <div class="summary-line">
            <div class="summary" itemprop="abstract">
              <p>
                Large projects accumulate a large number of issue reports over
                time. This is normal. Typically for a &quot;successful&quot;
                project the rate of new issues being reported will exceed the
                rate of issues being fixed. Hence the growth.
              </p>
              <p>
                But what are they to do about this ever-growing pile of bugs?
              </p>
            </div>
          </div>
          <p class="more">
            <a href="/posts/on-wontfixing-bugs/">Read more …</a>
          </p>
        </div>
      </div>

      <div
        class="post-card"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/posts/inktober-decay/">
            <span itemprop="name">Inktober - Decay</span>
          </a>
        </h3>
        <nav>
          <span class="date">
            Last updated on
            <time datetime="2022-01-13" itemprop="datePublished"
              >January 13, 2022</time
            >
          </span>

          <span class="fill"></span>

          <span class="tag-link">
            <a href="/tags/inktober/">#Inktober</a>
          </span>
        </nav>
      </div>

      <div
        class="post-card"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/posts/intermezzo-2025/">
            <span itemprop="name">Intermission - Q1 of 2025</span>
          </a>
        </h3>
        <nav>
          <span class="date">
            Last updated on
            <time datetime="2025-05-03" itemprop="datePublished"
              >May 3, 2025</time
            >. Originally posted on
            <time datetime="2025-04-07" itemprop="dateCreated"
              >April 7, 2025</time
            >
          </span>

          <span class="fill"></span>

          <span class="tag-link">
            <a href="/tags/culture/">#Culture</a>
          </span>
        </nav>
        <div>
          <div class="summary-line">
            <div class="summary" itemprop="abstract">
              <p>
                Hate can be suppressed temporarily, but cannot be contained for
                too long.
              </p>
            </div>
          </div>
          <p class="more"><a href="/posts/intermezzo-2025/">Read more …</a></p>
        </div>
      </div>

      <div
        class="post-card"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h3 class="title">
          <a itemprop="url" href="/series/structure-of-experience/flame/"
            ><span class="series-name">Structure Of Experience</span>:
            <span itemprop="name">Act III: Flame</span>
          </a>
        </h3>
        <nav>
          <span class="date">
            Last updated on
            <time datetime="2025-05-07" itemprop="datePublished"
              >May 7, 2025</time
            >
          </span>

          <span class="fill"></span>

          <span class="tag-link">
            <a href="/tags/ai/">#AI</a>
          </span>
        </nav>
        <div>
          <div class="summary-line">
            <div class="summary" itemprop="abstract">
              <p>
                The map is not the territory. A picture of a flame is not a
                flame. A description of a neural network is not a brain. A
                simulation of thought is not a consciousness.
              </p>
            </div>
          </div>
          <p class="more">
            <a href="/series/structure-of-experience/flame/">Read more …</a>
          </p>
        </div>
      </div>
    </footer>

    <!-- Google analytics -->
    <script
      async=""
      src="https://www.googletagmanager.com/gtag/js?id=G-GSREL2EZ4Y"
    ></script>
    <script>
      var dnt,
        doNotTrack = !1;
      if (
        (!1 &&
          ((dnt =
            navigator.doNotTrack ||
            window.doNotTrack ||
            navigator.msDoNotTrack),
          (doNotTrack = dnt == "1" || dnt == "yes")),
        !doNotTrack)
      ) {
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        (gtag("js", new Date()), gtag("config", "G-GSREL2EZ4Y"));
      }
    </script>
  </body>
</html>
