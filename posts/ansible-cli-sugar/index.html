<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8" />
    <title>Easier CLI for ad-hoc Ansible tasks and playbooks</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/images/apple-touch-icon.png"
    />
    <link rel="icon" href="/images/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/images/favicon-32x32.png"
    />
    <link rel="manifest" href="/site.webmanifest" />
    <link
      rel="mask-icon"
      href="/images/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />

    <link
      href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,200..900;1,200..900&family=Inconsolata:wght@200..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap&family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles/C7rAX9391l.css" />
    <link rel="me" href="mailto:asanka@gmail.com" />
    <link rel="me" href="https://github.com/asankah" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="ai-generated" content="none" />
  </head>

  <body>
    <header class="container">
      <nav class="top" itemscope="" itemtype="https://schema.org/Blog">
        <h1 itemprop="name">
          <a href="/" itemprop="url">Strong Opinions Weekly Held</a>
        </h1>
        <span></span>

        <h2><a href="/">Home</a></h2>

        <h2 itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="/about/me/" itemprop="sameAs">About</a>
        </h2>

        <h2><a href="/tags/">Tags</a></h2>
        <h2>
          <a href="/feed.xml"><img src="/images/rss.svg" /></a>
        </h2>
      </nav>
    </header>

    <article itemscope="" itemtype="https://schema.org/BlogPosting">
      <link itemprop="url" href="/posts/ansible-cli-sugar/" />
      <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
      <header class="container">
        <div class="">
          <h1 itemprop="name">
            Easier CLI for ad-hoc Ansible tasks and playbooks
          </h1>
          <nav>
            <div class="metadata">
              Published on
              <time datetime="2020-06-01" itemprop="datePublished"
                >June 1, 2020</time
              >
              by <span class="author" itemprop="author">Asanka Herath</span>.

              <br />
              Estimated reading time is <time>6 minutes</time>.
            </div>
            <span></span>
            <menu class="tags">
              <li>
                <span class="tag"> #<a href="/tags/tools/">Tools</a> </span>
              </li>
            </menu>
          </nav>
        </div>
      </header>

      <main itemprop="articleBody" class="container">
        <p>
          This article is about using
          <a href="https://ansible.com">Ansible</a> on the command-line.
        </p>
        <h2 id="problem">Problem:</h2>
        <p>You …</p>
        <ul>
          <li>
            <p>
              … want a convenient way to do ad-hoc tasks on a bunch of machines.
            </p>
          </li>
          <li>
            <p>
              … already have a few playbooks and machine groups defined in your
              inventory.
            </p>
          </li>
          <li>
            <p>
              … don’t want to invest too much into Ansible because you have
              other things to do and Ansible is just a tool to deal with one
              aspect of what you want to do.
            </p>
          </li>
          <li><p>… live on the command-line.</p></li>
          <li>
            <p>
              … think <code>ansible-playbook</code> and
              <code>ansible</code> commands have too many knobs and too few
              knobs at the same time.
            </p>
          </li>
        </ul>
        <h2 id="a-possible-solution">A Possible Solution</h2>
        <p>
          Taking a page from old school Posix tools, let’s make a script that
          encodes Ansible group names into the filename.
        </p>
        <p>Then you can go from this:</p>
        <div class="sourceCode" id="cb1">
          <pre
            class="sourceCode sh"
          ><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ansible atlanta <span class="at">-m</span> copy <span class="at">-a</span> <span class="st">&quot;src=/etc/hosts dest=/tmp/hosts&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ansible webservers <span class="at">-m</span> service <span class="at">-a</span> <span class="st">&quot;name=httpd state=started&quot;</span></span></code></pre>
        </div>
        <p>To this:</p>
        <div class="sourceCode" id="cb2">
          <pre
            class="sourceCode sh"
          ><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> atlanta copy <span class="st">&quot;src=/etc/hosts dest=/tmp/hosts&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> webservers service <span class="st">&quot;name=https state=started&quot;</span></span></code></pre>
        </div>
        <p>Or from this:</p>
        <div class="sourceCode" id="cb3">
          <pre
            class="sourceCode sh"
          ><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ansible-playbook <span class="at">-l</span> atlanta go-to-the-moon</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ansible-playbook <span class="at">-l</span> webservers do-the-other-things</span></code></pre>
        </div>
        <p>To this:</p>
        <div class="sourceCode" id="cb4">
          <pre
            class="sourceCode sh"
          ><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> atlanta go-to-the-moon</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> webservers do-the-other-things</span></code></pre>
        </div>
        <h2 id="setting-up">Setting Up</h2>
        <p>
          These are just examples. Please don’t spend time bikeshedding names
          because you can use whichever names you like.
        </p>
        <ol type="1">
          <li>
            <p>
              Download the contents of <code>ansible-by-proxy</code> from
              <a
                href="https://github.com/asankah/ansible-cli-sugar/blob/master/ansible-by-proxy"
                >here</a
              >. It’s a starter script that includes a bunch of sensible
              settings expressed via environment variables. Remove or change
              these to match your needs.
            </p>
            <p>
              Note that the script expects to find a sub-directory called
              <code>ansible</code> in the same directory as the script which
              contains the playbooks and the inventory file.
            </p>
          </li>
          <li>
            <p>Store this file somewhere on the system <code>PATH</code>.</p>
            <p>
              Don’t forget to mark the file as executable if it isn’t already.
            </p>
            <div class="sourceCode" id="cb5">
              <pre
                class="sourceCode sh"
              ><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> chmod +x ansible-by-proxy</span></code></pre>
            </div>
          </li>
          <li>
            <p>
              Create symlinks to the file that have the same name as hostnames
              or groups as described in the includes:
            </p>
            <div class="sourceCode" id="cb6">
              <pre
                class="sourceCode sh"
              ><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ln <span class="at">-s</span> ansible-by-proxy atlanta</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ln <span class="at">-s</span> ansible-by-proxy webservers</span></code></pre>
            </div>
            <p>and so on.</p>
          </li>
        </ol>
        <p>
          That’s it. Now you can invoke playbooks and tasks just by using the
          name of host or group.
        </p>
      </main>

      <footer class="container">
        <div>
          <p>Last modified: <time datetime="2020-06-01">June 1, 2020</time></p>
        </div>
      </footer>
    </article>

    <div class="container"></div>

    <footer class="container">
      <h2>More posts from this blog ...</h2>
      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h2 class="title">
          <a itemprop="url" href="/posts/on-wontfixing-bugs/">
            <span itemprop="name">On WontFixing Bugs</span>
          </a>
        </h2>
        <div class="summary-row">
          <div>
            <nav>
              <small>
                Published on
                <time datetime="2021-03-02" itemprop="datePublished"
                  >March 2, 2021</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag">
                    #<a href="/tags/engineering/">Engineering</a>
                  </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  Large projects accumulate a large number of issue reports over
                  time. This is normal. Typically for a &quot;successful&quot;
                  project the rate of new issues being reported will exceed the
                  rate of issues being fixed. Hence the growth.
                </p>
                <p>
                  But what are they to do about this ever-growing pile of bugs?
                </p>
              </div>
            </div>
            <p class="more">
              <a href="/posts/on-wontfixing-bugs/">Read more …</a>
            </p>
          </div>
        </div>
      </div>

      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h2 class="title">
          <a itemprop="url" href="/posts/git-autopush/">
            <span itemprop="name"
              >Use Git hooks to automatically push after every commit</span
            >
          </a>
        </h2>
        <div class="summary-row">
          <div>
            <nav>
              <small>
                Published on
                <time datetime="2022-07-05" itemprop="datePublished"
                  >July 5, 2022</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag"> #<a href="/tags/tools/">Tools</a> </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  During before and after various Git operations, Git invokes
                  special hooks that can be used execute custom scripts. This
                  article explains how to use them to automatically push to an
                  upstream repository every time you make a commit to a local
                  repo.
                </p>
              </div>
            </div>
            <p class="more"><a href="/posts/git-autopush/">Read more …</a></p>
          </div>
        </div>
      </div>

      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h2 class="title">
          <a itemprop="url" href="/posts/evluating-negatives/">
            <span itemprop="name"
              >Inclusion/Equity and Evaluating Negatives</span
            >
          </a>
        </h2>
        <div class="summary-row">
          <div>
            <nav>
              <small>
                Published on
                <time datetime="2024-01-10" itemprop="datePublished"
                  >January 10, 2024</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag">
                    #<a href="/tags/engineering/">Engineering</a>
                  </span>
                </li>
                <li>
                  <span class="tag">
                    #<a href="/tags/inclusion-and-equity/"
                      >Inclusion and Equity</a
                    >
                  </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  Evaluating properties like inclusion and equity of products
                  can't be done through exhaustive enumeration of product
                  outcomes. Instead we will need to increasingly rely on the
                  controls that we place how we construct the products.
                </p>
              </div>
            </div>
            <p class="more">
              <a href="/posts/evluating-negatives/">Read more …</a>
            </p>
          </div>
        </div>
      </div>

      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h2 class="title">
          <a itemprop="url" href="/series/structure-of-experience/preface/"
            ><span class="series-name">Structure Of Experience</span>:
            <span itemprop="name">Preface</span>
          </a>
        </h2>
        <div class="summary-row">
          <div>
            <nav>
              <small>
                Published on
                <time datetime="2025-05-01" itemprop="datePublished"
                  >May 1, 2025</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag"> #<a href="/tags/ai/">AI</a> </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  A very gentle introduction to how large language models
                  <em>almost</em> capture human experience through language.
                </p>
              </div>
            </div>
            <p class="more">
              <a href="/series/structure-of-experience/preface/">Read more …</a>
            </p>
          </div>
        </div>
      </div>

      <div
        class="post-summary"
        itemscope=""
        itemtype="https://schema.org/BlogPosting"
      >
        <link itemprop="isPartOf" itemtype="https://schema.org/Blog" href="/" />
        <h2 class="title">
          <a itemprop="url" href="/posts/cog-ratio/">
            <span itemprop="name">What&#39;s your cog ratio?</span>
          </a>
        </h2>
        <div class="summary-row">
          <a href="/posts/cog-ratio/">
            <img
              src="/img/DFcev-mNF2-200.png"
              alt="Cogs, cogs, cogs."
              class="noinvert hero"
              width="200"
              height="109"
            />
          </a>

          <div>
            <nav>
              <small>
                Published on
                <time datetime="2025-12-16" itemprop="datePublished"
                  >December 16, 2025</time
                >.
              </small>
              <span></span>
              <menu class="tags">
                <li>
                  <span class="tag">
                    #<a href="/tags/organizations/">Organizations</a>
                  </span>
                </li>
              </menu>
            </nav>
            <div class="summary-row">
              <div itemprop="abstract">
                <p>
                  The &quot;cog ratio&quot; is a metaphor for how much an
                  individual's work on a product directly translates into a
                  better user experience. While everyone on a team contributes,
                  roles further from direct product development—like management,
                  HR, or infrastructure—can feel disconnected from the end-user.
                  What is our own &quot;cog ratio&quot; and how effectively will
                  our efforts truly drive meaningful change for the people we
                  serve?
                </p>
              </div>
            </div>
            <p class="more"><a href="/posts/cog-ratio/">Read more …</a></p>
          </div>
        </div>
      </div>
    </footer>

    <script
      async=""
      src="https://www.googletagmanager.com/gtag/js?id=G-GSREL2EZ4Y"
    ></script>
    <script>
      var dnt,
        doNotTrack = !1;
      if (
        (!1 &&
          ((dnt =
            navigator.doNotTrack ||
            window.doNotTrack ||
            navigator.msDoNotTrack),
          (doNotTrack = dnt == "1" || dnt == "yes")),
        !doNotTrack)
      ) {
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        (gtag("js", new Date()), gtag("config", "G-GSREL2EZ4Y"));
      }
    </script>
  </body>
</html>
